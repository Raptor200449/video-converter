<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>FluxConvert ‚Äì Outils vid√©o simples & rapides</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --bg: #020617;
            --bg-card: #020617;
            --bg-elevated: #020617;
            --border-subtle: #1f2937;
            --accent: #6366f1;
            --accent-soft: rgba(99, 102, 241, 0.15);
            --accent-strong: #4f46e5;
            --text: #e5e7eb;
            --text-soft: #9ca3af;
            --danger: #ef4444;
        }
        body[data-theme="light"] {
            --bg: #f3f4f6;
            --bg-card: #ffffff;
            --bg-elevated: #f9fafb;
            --border-subtle: #e5e7eb;
            --accent: #4f46e5;
            --accent-soft: rgba(79, 70, 229, 0.08);
            --accent-strong: #4f46e5;
            --text: #111827;
            --text-soft: #6b7280;
            --danger: #b91c1c;
        }
        body {
            margin: 0;
            min-height: 100vh;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top, #111827 0, #020617 40%, #000 100%);
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }
        body[data-theme="light"] {
            background: radial-gradient(circle at top, #e5e7eb 0, #f3f4f6 40%, #e5e7eb 100%);
        }
        * { box-sizing: border-box; }

        .shell { max-width: 1100px; width: 100%; padding: 20px; }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 18px;
        }
        .brand { display: flex; align-items: center; gap: 10px; }

        .logo {
            width: 34px; height: 34px;
            border-radius: 12px;
            background: radial-gradient(circle at 30% 30%, #f97316, #ef4444, #6366f1);
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 18px; color: white;
        }
        body[data-theme="light"] .logo {
            background: radial-gradient(circle at 30% 30%, #f97316, #ef4444, #4f46e5);
        }
        .title-block h1 { font-size: 1.3rem; margin: 0; }
        .title-block p { margin: 2px 0 0; font-size: 0.85rem; color: var(--text-soft); }

        .header-right { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; }
        .badge {
            font-size: 0.75rem; border-radius: 999px; padding: 4px 10px;
            border: 1px solid rgba(148, 163, 184, 0.5); color: var(--text-soft); white-space: nowrap;
        }
        .top-controls { display: flex; gap: 8px; }

        .pill-button {
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.6);
            background: rgba(15,23,42,0.9);
            color: #e5e7eb;
            font-size: 0.75rem;
            padding: 4px 10px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: background 0.15s, transform 0.08s, box-shadow 0.12s;
        }
        .pill-button:hover {
            transform: translateY(-0.5px);
            box-shadow: 0 6px 12px rgba(15,23,42,0.5);
        }
        body[data-theme="light"] .pill-button {
            background: #f9fafb;
            color: #111827;
        }
        .pill-button span.icon { font-size: 0.95rem; }

        .lang-select {
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.6);
            background: rgba(15,23,42,0.9);
            color: #e5e7eb;
            font-size: 0.75rem;
            padding: 4px 8px;
            cursor: pointer;
        }
        body[data-theme="light"] .lang-select {
            background: #f9fafb;
            color: #111827;
        }

        .grid {
            display: grid;
            grid-template-columns: minmax(0, 1.7fr) minmax(0, 1fr);
            gap: 18px;
        }
        @media (max-width: 900px) {
            .grid { grid-template-columns: minmax(0, 1fr); }
        }

        .card {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 18px;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 18px 40px rgba(0,0,0,0.8), 0 0 0 1px rgba(148,163,184,0.12);
            padding: 18px 18px 16px;
        }
        body[data-theme="light"] .card {
            background: var(--bg-card);
            box-shadow: 0 16px 40px rgba(15, 23, 42, 0.10), 0 0 0 1px rgba(148,163,184,0.18);
        }
        .card h2 { font-size: 1rem; margin: 0 0 4px; }
        .card-subtitle { font-size: 0.8rem; color: var(--text-soft); margin-bottom: 8px; }

        .mode-tabs {
            display: flex; flex-wrap: wrap; gap: 6px;
            margin: 10px 0 14px;
        }
        .mode-tab {
            font-size: 0.78rem;
            padding: 5px 10px;
            border-radius: 999px;
            border: 1px solid rgba(55,65,81,0.9);
            background: rgba(15,23,42,0.9);
            color: var(--text-soft);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: background 0.15s, transform 0.08s, box-shadow 0.12s, color 0.15s;
        }
        .mode-tab span.icon { font-size: 0.9rem; }
        .mode-tab:hover {
            transform: translateY(-0.5px);
            box-shadow: 0 6px 18px rgba(15,23,42,0.7);
        }
        .mode-tab.active {
            background: var(--accent-soft);
            color: #e5e7eb;
            border-color: var(--accent-strong);
        }
        body[data-theme="light"] .mode-tab {
            background: #f9fafb;
            border-color: #e5e7eb;
        }

        .steps { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .step {
            flex: 1; min-width: 110px;
            display: flex; align-items: center; gap: 8px;
            font-size: 0.75rem; padding: 6px 8px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(55, 65, 81, 0.9);
        }
        body[data-theme="light"] .step {
            background: #f9fafb;
            border-color: #e5e7eb;
        }
        .step span.icon {
            width: 18px; height: 18px; border-radius: 999px;
            background: var(--accent-soft);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.75rem; color: #c7d2fe;
        }
        .step strong { color: var(--text); }
        .step small { display: block; color: var(--text-soft); }

        .dropzone {
            border-radius: 16px;
            padding: 18px 16px;
            border: 1.5px dashed rgba(148, 163, 184, 0.6);
            background: radial-gradient(circle at top left, rgba(56,189,248,0.08), transparent 55%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s, transform 0.08s, box-shadow 0.15s;
        }
        .dropzone:hover {
            border-color: var(--accent);
            box-shadow: 0 12px 30px rgba(56,189,248,0.25);
        }
        body[data-theme="light"] .dropzone {
            background: radial-gradient(circle at top left, rgba(56,189,248,0.06), #f9fafb);
        }
        .dropzone.dragover {
            border-color: var(--accent);
            background: radial-gradient(circle at top, rgba(129,140,248,0.22), transparent 60%);
            transform: translateY(-1px);
        }

        .dz-icon {
            width: 38px; height: 38px;
            border-radius: 14px;
            background: rgba(15,23,42,0.94);
            border: 1px solid rgba(55,65,81,0.9);
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
        }
        body[data-theme="light"] .dz-icon {
            background: #f9fafb;
            border-color: #e5e7eb;
        }
        .dz-main { font-size: 0.9rem; }
        .dz-main strong { color: var(--text); }
        .dz-main span { color: var(--accent); }
        .dz-sub { font-size: 0.75rem; color: var(--text-soft); }

        .dz-filename {
            font-size: 0.8rem;
            color: #cbd5f5;
            background: rgba(15,23,42,0.96);
            border-radius: 999px;
            padding: 4px 10px;
            border: 1px solid rgba(55,65,81,0.9);
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        body[data-theme="light"] .dz-filename {
            background: #f9fafb;
            border-color: #e5e7eb;
            color: #111827;
        }
        input[type="file"] { display: none; }

        .secondary-upload {
            margin-top: 10px;
            padding: 8px 10px;
            border-radius: 12px;
            border: 1px dashed rgba(148,163,184,0.6);
            background: rgba(15,23,42,0.7);
            font-size: 0.78rem;
        }
        body[data-theme="light"] .secondary-upload {
            background: #f9fafb;
        }
        .secondary-upload label {
            cursor: pointer;
            color: var(--accent);
        }
        .secondary-filename {
            margin-top: 4px;
            font-size: 0.76rem;
            color: var(--text-soft);
        }

        .advanced { margin-top: 12px; }
        .advanced-toggle {
            width: 100%;
            border-radius: 999px;
            border: 1px solid rgba(55,65,81,0.9);
            background: rgba(15,23,42,0.92);
            padding: 6px 11px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            color: var(--text-soft);
        }
        body[data-theme="light"] .advanced-toggle {
            background: #f9fafb;
            border-color: #e5e7eb;
        }
        .advanced-summary {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .advanced-chevron {
            font-size: 0.8rem;
            transition: transform 0.15s;
        }
        .advanced-toggle.open .advanced-chevron {
            transform: rotate(180deg);
        }
        .advanced-panel { margin-top: 8px; display: none; }

        .form-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .field { flex: 1; min-width: 140px; }
        .field label {
            font-size: 0.8rem;
            color: var(--text-soft);
            display: block;
            margin-bottom: 4px;
        }
        select, input[type="number"] {
            width: 100%;
            border-radius: 999px;
            border: 1px solid rgba(55,65,81,0.9);
            background: #020617;
            color: var(--text);
            padding: 7px 11px;
            font-size: 0.85rem;
            outline: none;
        }
        body[data-theme="light"] select,
        body[data-theme="light"] input[type="number"] {
            background: #f9fafb;
            border-color: #e5e7eb;
        }
        select:focus, input[type="number"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(129,140,248,0.4);
        }

        .time-wrapper {
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px dashed rgba(55,65,81,0.7);
        }
        .time-hint {
            font-size: 0.72rem;
            color: var(--text-soft);
            margin-bottom: 4px;
        }

        .actions {
            display: flex;
            flex-direction: column;
            margin-top: 14px;
            gap: 6px;
        }
        button.main-btn {
            border-radius: 999px;
            border: none;
            padding: 9px 14px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            background: linear-gradient(135deg, #6366f1, #ec4899);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: transform 0.08s, box-shadow 0.12s, opacity 0.12s;
            box-shadow: 0 10px 25px rgba(129,140,248,0.4);
        }
        button.main-btn:hover:not(:disabled) {
            transform: translateY(-0.5px);
            box-shadow: 0 16px 35px rgba(129,140,248,0.5);
            opacity: 0.96;
        }
        button.main-btn:disabled {
            opacity: 0.6;
            cursor: default;
            box-shadow: none;
        }
        .btn-label-main { display: flex; align-items: center; gap: 6px; }
        .btn-label-main span.icon { font-size: 1rem; }
        .btn-sub { font-size: 0.72rem; color: #e5e7eb; }

        .status {
            font-size: 0.78rem;
            color: var(--text-soft);
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: 18px;
        }
        .status-dot {
            width: 8px; height: 8px;
            border-radius: 999px;
            background: #22c55e;
        }
        .status-dot.busy {
            background: #facc15;
            animation: pulse 1s infinite ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.25); opacity: 0.4; }
            100% { transform: scale(1); opacity: 0.9; }
        }
        .hint { font-size: 0.72rem; color: var(--text-soft); margin-top: 4px; }
        .error-box { font-size: 0.72rem; margin-top: 4px; color: #fca5a5; }
        body[data-theme="light"] .error-box { color: #b91c1c; }

        .side {
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 0.78rem;
        }
        .side-card {
            border-radius: 16px;
            border: 1px solid rgba(31,41,55,0.95);
            background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.92));
            padding: 12px 14px;
        }
        body[data-theme="light"] .side-card {
            background: linear-gradient(145deg, #ffffff, #f9fafb);
        }
        .side-title { font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; }
        .pill-row { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px; }
        .pill {
            border-radius: 999px;
            border: 1px solid rgba(55,65,81,0.9);
            padding: 3px 8px;
            font-size: 0.7rem;
            color: #cbd5f5;
            background: rgba(15,23,42,0.95);
        }
        body[data-theme="light"] .pill {
            background: #f9fafb;
            border-color: #e5e7eb;
            color: #111827;
        }
        .muted { color: var(--text-soft); }
        .muted-strong { color: var(--text); font-weight: 500; }
        .limit { margin-top: 4px; font-size: 0.72rem; color: #fbbf24; }
        .legal { margin-top: 4px; font-size: 0.7rem; color: #6b7280; }

        .footer {
            margin-top: 16px;
            font-size: 0.72rem;
            color: var(--text-soft);
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 8px;
            border-top: 1px solid rgba(31,41,55,0.9);
            padding-top: 8px;
        }
        body[data-theme="light"] .footer { border-top-color: #e5e7eb; }
        .footer-left span { font-weight: 500; color: var(--text); }
        .footer-links { display: flex; gap: 10px; flex-wrap: wrap; }
        .footer-link { cursor: default; text-decoration: none; color: var(--text-soft); }
        .footer-link:hover { text-decoration: underline; }
    </style>
</head>
<body data-theme="dark"
      data-preset-mode="{{ preset_mode|default('', true) }}"
      data-preset-format="{{ preset_format|default('', true) }}">
<div class="shell">
    <header class="header">
        <div class="brand">
            <div class="logo">FC</div>
            <div class="title-block">
                <h1 data-i18n="header.title">FluxConvert ‚Äì Outils vid√©o simples & rapides</h1>
                <p data-i18n="header.subtitle">D√©pose un fichier, choisis un mode, r√©cup√®re le r√©sultat.</p>
            </div>
        </div>
        <div class="header-right">
            <div class="badge" data-i18n="header.badge">
                ‚ö° 100% gratuit ‚Ä¢ c√¥t√© serveur
            </div>
            <div class="top-controls">
                <button type="button" class="pill-button" id="theme-toggle">
                    <span class="icon" id="theme-toggle-icon">üåô</span>
                    <span id="theme-toggle-label" data-i18n="header.themeDark">Mode sombre</span>
                </button>
                <select id="lang-select" class="lang-select">
                    <option value="auto" data-i18n="lang.auto">Auto</option>
                    <option value="fr">FR</option>
                    <option value="en">EN</option>
                </select>
            </div>
        </div>
    </header>

    <main class="grid">
        <section class="card">
            <h2 data-i18n="main.title">Un seul √©cran, tous tes outils</h2>
            <div class="card-subtitle" data-i18n="main.subtitle">
                Choisis ce que tu veux faire, le reste est pr√™t.
            </div>

            <div class="mode-tabs">
                <button class="mode-tab active" data-mode="convert">
                    <span class="icon">üéØ</span>
                    <span data-i18n="modes.convert">Convertir</span>
                </button>
                <button class="mode-tab" data-mode="compress">
                    <span class="icon">üåÄ</span>
                    <span data-i18n="modes.compress">Compresser</span>
                </button>
                <button class="mode-tab" data-mode="audio">
                    <span class="icon">üéß</span>
                    <span data-i18n="modes.audio">Audio only</span>
                </button>
                <button class="mode-tab" data-mode="gif">
                    <span class="icon">üéûÔ∏è</span>
                    <span data-i18n="modes.gif">GIF</span>
                </button>
                <button class="mode-tab" data-mode="cut">
                    <span class="icon">‚úÇÔ∏è</span>
                    <span data-i18n="modes.cut">Cut</span>
                </button>
                <button class="mode-tab" data-mode="merge">
                    <span class="icon">‚ûï</span>
                    <span data-i18n="modes.merge">Fusionner</span>
                </button>
            </div>

            <div class="steps">
                <div class="step">
                    <span class="icon">1</span>
                    <div>
                        <strong data-i18n="steps.1.title">D√©pose ton fichier</strong>
                        <small data-i18n="steps.1.text">Vid√©o ou audio.</small>
                    </div>
                </div>
                <div class="step">
                    <span class="icon">2</span>
                    <div>
                        <strong data-i18n="steps.2.title">Choisis un mode</strong>
                        <small data-i18n="steps.2.text">Convert, compress, audio, GIF, cut ou fusion.</small>
                    </div>
                </div>
                <div class="step">
                    <span class="icon">3</span>
                    <div>
                        <strong data-i18n="steps.3.title">T√©l√©charge</strong>
                        <small data-i18n="steps.3.text">Fichier pr√™t en un clic.</small>
                    </div>
                </div>
            </div>

            <form id="convert-form" action="/convert" method="post" enctype="multipart/form-data">
                <input type="hidden" id="operation" name="operation" value="convert">

                <label for="file" class="dropzone" id="dropzone">
                    <div class="dz-icon">‚¨Ü</div>
                    <div class="dz-main">
                        <strong data-i18n="drop.title">Glisse ton fichier ici</strong><br>
                        <span data-i18n="drop.subtitle">ou clique pour le choisir</span>
                    </div>
                    <div class="dz-sub" data-i18n="drop.help">
                        MP4, MOV, MKV, MP3, WAV‚Ä¶ c‚Äôest bon.
                    </div>
                    <div class="dz-filename" id="dz-filename" style="display:none;"></div>
                    <input type="file" id="file" name="file" required>
                </label>

                <div class="secondary-upload" id="secondary-upload" style="display:none;">
                    <div data-i18n="merge.secondary.label">
                        2·µâ fichier pour la fusion :
                        <label for="file2">clique pour le choisir</label>
                    </div>
                    <input type="file" id="file2" name="file2" style="display:none;">
                    <div class="secondary-filename" id="secondary-filename"></div>
                </div>

                <div class="advanced">
                    <button type="button" class="advanced-toggle" id="advanced-toggle">
                        <span class="advanced-summary" id="advanced-summary">
                            MP4 ‚Ä¢ 720p ‚Ä¢ 30 fps ‚Ä¢ Standard
                        </span>
                        <span class="advanced-chevron">‚ñæ</span>
                    </button>
                    <div class="advanced-panel" id="advanced-panel">
                        <div class="form-row">
                            <div class="field">
                                <label for="target_format" data-i18n="form.formatLabel">Format de sortie</label>
                                <select id="target_format" name="target_format">
                                    <option value="mp4" data-i18n="form.format.mp4">MP4 (vid√©o)</option>
                                    <option value="mp3" data-i18n="form.format.mp3">MP3 (audio)</option>
                                    <option value="wav" data-i18n="form.format.wav">WAV</option>
                                    <option value="mkv" data-i18n="form.format.mkv">MKV</option>
                                    <option value="mov" data-i18n="form.format.mov">MOV</option>
                                </select>
                            </div>

                            <div class="field">
                                <label for="quality" data-i18n="form.qualityLabel">Qualit√© / poids</label>
                                <select id="quality" name="quality">
                                    <option value="standard" data-i18n="form.quality.standard">Standard</option>
                                    <option value="light" data-i18n="form.quality.light">Plus l√©ger</option>
                                    <option value="strong" data-i18n="form.quality.strong">Ultra l√©ger</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row" style="margin-top:8px;">
                            <div class="field">
                                <label for="resolution" data-i18n="form.resolutionLabel">R√©solution vid√©o</label>
                                <select id="resolution" name="resolution">
                                    <option value="source" data-i18n="form.resolution.source">Source</option>
                                    <option value="480p" data-i18n="form.resolution.480">480p</option>
                                    <option value="720p" data-i18n="form.resolution.720">720p</option>
                                    <option value="1080p" data-i18n="form.resolution.1080">1080p</option>
                                </select>
                            </div>

                            <div class="field">
                                <label for="fps" data-i18n="form.fpsLabel">Images par seconde</label>
                                <select id="fps" name="fps">
                                    <option value="source" data-i18n="form.fps.source">Source</option>
                                    <option value="24">24 fps</option>
                                    <option value="30">30 fps</option>
                                    <option value="60">60 fps</option>
                                </select>
                            </div>

                            <div class="field">
                                <label for="audio_bitrate" data-i18n="form.audioBitrateLabel">Bitrate audio</label>
                                <select id="audio_bitrate" name="audio_bitrate">
                                    <option value="auto" data-i18n="form.audioBitrate.auto">Auto</option>
                                    <option value="128k">128 kbps</option>
                                    <option value="192k">192 kbps</option>
                                    <option value="256k">256 kbps</option>
                                    <option value="320k">320 kbps</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row" style="margin-top:8px;">
                            <div class="field">
                                <label for="speed" data-i18n="form.speedLabel">Vitesse</label>
                                <select id="speed" name="speed">
                                    <option value="1.0" data-i18n="form.speed.1">Normal (1√ó)</option>
                                    <option value="0.5" data-i18n="form.speed.05">Ralenti 0,5√ó</option>
                                    <option value="0.75" data-i18n="form.speed.075">L√©ger ralenti 0,75√ó</option>
                                    <option value="1.25" data-i18n="form.speed.125">Un peu plus rapide 1,25√ó</option>
                                    <option value="1.5" data-i18n="form.speed.15">Rapide 1,5√ó</option>
                                    <option value="2.0" data-i18n="form.speed.2">Tr√®s rapide 2√ó</option>
                                </select>
                            </div>
                            <div class="field">
                                <label for="reverse" data-i18n="form.reverseLabel">Lecture invers√©e</label>
                                <div style="display:flex;align-items:center;gap:6px;">
                                    <input type="checkbox" id="reverse" name="reverse" style="width:auto;">
                                    <span style="font-size:0.8rem;" data-i18n="form.reverseHelp">
                                        Lecture de la fin vers le d√©but.
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="time-wrapper" id="time-wrapper" style="display:none;">
                    <div class="time-hint" data-i18n="time.hint">
                        GIF / Cut : indique un d√©but (sec) + une dur√©e ou une fin.
                    </div>
                    <div class="form-row">
                        <div class="field">
                            <label for="start_time" data-i18n="time.start">D√©but (s)</label>
                            <input type="number" id="start_time" name="start_time" min="0" step="0.1">
                        </div>
                        <div class="field" id="duration-group">
                            <label for="duration" data-i18n="time.duration">Dur√©e (s)</label>
                            <input type="number" id="duration" name="duration" min="0" step="0.1">
                        </div>
                        <div class="field" id="end_time-group" style="display:none;">
                            <label for="end_time" data-i18n="time.end">Fin (s)</label>
                            <input type="number" id="end_time" name="end_time" min="0" step="0.1">
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button type="submit" id="convert-btn" class="main-btn">
                        <div class="btn-label-main">
                            <span class="icon">‚öôÔ∏è</span>
                            <span id="btn-mainlabel" data-i18n="button.label.convert">Convertir</span>
                        </div>
                        <div class="btn-sub" id="btn-subtext" data-i18n="button.sub">
                            Tout se fait c√¥t√© serveur. Tu attends, et c‚Äôest bon.
                        </div>
                    </button>
                    <div class="status" id="status">
                        <div class="status-dot" id="status-dot"></div>
                        <span id="status-text" data-i18n="status.ready">Pr√™t quand toi tu l‚Äôes.</span>
                    </div>
                    <div id="error-box" class="error-box" style="display:none;"></div>
                    <div class="hint" data-i18n="hint.text">
                        Tip : teste d‚Äôabord avec un petit extrait.
                    </div>
                </div>
            </form>
        </section>

        <aside class="side">
            <div class="side-card">
                <div class="side-title" data-i18n="side.profile.title">Presets rapides</div>
                <div class="muted">
                    <span class="muted-strong" data-i18n="side.profile.convertTitle">Lecture partout :</span>
                    <ul style="margin: 4px 0 6px 16px; padding:0;">
                        <li data-i18n="side.profile.convert1">Convertir ¬∑ MP4 ¬∑ Standard</li>
                    </ul>
                </div>
                <div class="muted">
                    <span class="muted-strong" data-i18n="side.profile.socialTitle">TikTok / Shorts :</span>
                    <ul style="margin: 4px 0 6px 16px; padding:0;">
                        <li data-i18n="side.profile.social1">Compresser ¬∑ MP4 ¬∑ Plus l√©ger</li>
                    </ul>
                </div>
                <div class="muted">
                    <span class="muted-strong" data-i18n="side.profile.gifTitle">GIF rapide :</span>
                    <ul style="margin: 4px 0 0 16px; padding:0;">
                        <li data-i18n="side.profile.gif1">GIF ¬∑ 5‚Äì10 secondes max.</li>
                    </ul>
                </div>
                <div class="pill-row">
                    <div class="pill" data-i18n="side.profile.pill1">üîÅ Serveur</div>
                    <div class="pill" data-i18n="side.profile.pill2">üé¨ MP4 / MOV / MKV</div>
                    <div class="pill" data-i18n="side.profile.pill3">üéß MP3 / WAV</div>
                    <div class="pill" data-i18n="side.profile.pill4">üéûÔ∏è GIF courts</div>
                </div>
                <div class="limit" data-i18n="side.profile.limit">
                    Vise quelques centaines de Mo max.
                </div>
            </div>

            <div class="side-card">
                <div class="side-title" data-i18n="side.info.title">Infos utiles</div>
                <div class="muted" data-i18n="side.info.text">
                    - Plus c‚Äôest compress√©, plus tu perds un peu de d√©tail.<br>
                    - GIF = petit extrait, pas un film.<br>
                    - Fichiers trait√©s puis supprim√©s.
                </div>
                <div class="legal" data-i18n="side.info.legal">
                    Envoie uniquement des fichiers que tu as le droit d‚Äôutiliser.
                </div>
            </div>
        </aside>
    </main>

    <footer class="footer">
        <div class="footer-left">
            <span>FluxConvert</span> ¬∑ <span data-i18n="footer.version">v0.6 beta</span>
        </div>
        <div class="footer-links">
            <span class="footer-link" data-i18n="footer.link.about">√Ä propos</span>
            <span class="footer-link" data-i18n="footer.link.faq">FAQ</span>
            <span class="footer-link" data-i18n="footer.link.contact">Contact (bient√¥t)</span>
        </div>
    </footer>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const fileInput = document.getElementById('file');
    const file2Input = document.getElementById('file2');
    const secondaryUpload = document.getElementById('secondary-upload');
    const secondaryFilename = document.getElementById('secondary-filename');
    const dropzone = document.getElementById('dropzone');
    const filenameEl = document.getElementById('dz-filename');
    const form = document.getElementById('convert-form');
    const btn = document.getElementById('convert-btn');
    const btnMainLabel = document.getElementById('btn-mainlabel');
    const statusText = document.getElementById('status-text');
    const statusDot = document.getElementById('status-dot');
    const btnSub = document.getElementById('btn-subtext');
    const themeToggleBtn = document.getElementById('theme-toggle');
    const themeToggleIcon = document.getElementById('theme-toggle-icon');
    const themeToggleLabel = document.getElementById('theme-toggle-label');
    const rootBody = document.body;
    const langSelect = document.getElementById('lang-select');
    const errorBox = document.getElementById('error-box');
    const modeTabs = document.querySelectorAll('.mode-tab');
    const operationInput = document.getElementById('operation');
    const timeWrapper = document.getElementById('time-wrapper');
    const durationGroup = document.getElementById('duration-group');
    const endTimeGroup = document.getElementById('end_time-group');
    const startTimeInput = document.getElementById('start_time');
    const durationInput = document.getElementById('duration');
    const endTimeInput = document.getElementById('end_time');
    const targetFormatSelect = document.getElementById('target_format');
    const qualitySelect = document.getElementById('quality');
    const resolutionSelect = document.getElementById('resolution');
    const fpsSelect = document.getElementById('fps');
    const audioBitrateSelect = document.getElementById('audio_bitrate');
    const speedSelect = document.getElementById('speed');
    const reverseCheckbox = document.getElementById('reverse');
    const advancedToggle = document.getElementById('advanced-toggle');
    const advancedPanel = document.getElementById('advanced-panel');
    const advancedSummary = document.getElementById('advanced-summary');

    const MAX_FILE_MB = 500;
    let currentMode = 'convert';

    const translations = {
        fr: {
            "header.title": "FluxConvert ‚Äì Outils vid√©o simples & rapides",
            "header.subtitle": "D√©pose un fichier, choisis un mode, r√©cup√®re le r√©sultat.",
            "header.badge": "‚ö° 100% gratuit ‚Ä¢ c√¥t√© serveur",
            "header.themeDark": "Mode sombre",
            "header.themeLight": "Mode clair",
            "lang.auto": "Auto",
            "main.title": "Un seul √©cran, tous tes outils",
            "main.subtitle": "Choisis ce que tu veux faire, le reste est pr√™t.",
            "modes.convert": "Convertir",
            "modes.compress": "Compresser",
            "modes.audio": "Audio only",
            "modes.gif": "GIF",
            "modes.cut": "Cut",
            "modes.merge": "Fusionner",
            "steps.1.title": "D√©pose ton fichier",
            "steps.1.text": "Vid√©o ou audio.",
            "steps.2.title": "Choisis un mode",
            "steps.2.text": "Convert, compress, audio, GIF, cut ou fusion.",
            "steps.3.title": "T√©l√©charge",
            "steps.3.text": "Fichier pr√™t en un clic.",
            "drop.title": "Glisse ton fichier ici",
            "drop.subtitle": "ou clique pour le choisir",
            "drop.help": "MP4, MOV, MKV, MP3, WAV‚Ä¶ c‚Äôest bon.",
            "form.formatLabel": "Format de sortie",
            "form.format.mp4": "MP4 (vid√©o)",
            "form.format.mp3": "MP3 (audio)",
            "form.format.wav": "WAV",
            "form.format.mkv": "MKV",
            "form.format.mov": "MOV",
            "form.qualityLabel": "Qualit√© / poids",
            "form.quality.standard": "Standard",
            "form.quality.light": "Plus l√©ger",
            "form.quality.strong": "Ultra l√©ger",
            "form.resolutionLabel": "R√©solution vid√©o",
            "form.resolution.source": "Source",
            "form.resolution.480": "480p",
            "form.resolution.720": "720p",
            "form.resolution.1080": "1080p",
            "form.fpsLabel": "Images par seconde",
            "form.fps.source": "Source",
            "form.audioBitrateLabel": "Bitrate audio",
            "form.audioBitrate.auto": "Auto",
            "form.speedLabel": "Vitesse",
            "form.speed.1": "Normal (1√ó)",
            "form.speed.05": "Ralenti 0,5√ó",
            "form.speed.075": "L√©ger ralenti 0,75√ó",
            "form.speed.125": "Un peu plus rapide 1,25√ó",
            "form.speed.15": "Rapide 1,5√ó",
            "form.speed.2": "Tr√®s rapide 2√ó",
            "form.reverseLabel": "Lecture invers√©e",
            "form.reverseHelp": "Lecture de la fin vers le d√©but.",
            "merge.secondary.label": "2·µâ fichier pour la fusion : ",
            "time.hint": "GIF / Cut : indique un d√©but (sec) + une dur√©e ou une fin.",
            "time.start": "D√©but (s)",
            "time.duration": "Dur√©e (s)",
            "time.end": "Fin (s)",
            "button.label.convert": "Convertir",
            "button.label.compress": "Compresser",
            "button.label.audio": "Extraire l‚Äôaudio",
            "button.label.gif": "Cr√©er le GIF",
            "button.label.cut": "Couper l‚Äôextrait",
            "button.label.merge": "Fusionner les vid√©os",
            "button.sub": "Tout se fait c√¥t√© serveur. Tu attends, et c‚Äôest bon.",
            "status.ready": "Pr√™t quand toi tu l‚Äôes.",
            "status.running": "Traitement en cours‚Ä¶",
            "summary.reverse": "Reverse",
            "hint.text": "Tip : teste d‚Äôabord avec un petit extrait.",
            "side.profile.title": "Presets rapides",
            "side.profile.convertTitle": "Lecture partout :",
            "side.profile.convert1": "Convertir ¬∑ MP4 ¬∑ Standard",
            "side.profile.socialTitle": "TikTok / Shorts :",
            "side.profile.social1": "Compresser ¬∑ MP4 ¬∑ Plus l√©ger",
            "side.profile.gifTitle": "GIF rapide :",
            "side.profile.gif1": "GIF ¬∑ 5‚Äì10 secondes max.",
            "side.profile.pill1": "üîÅ Serveur",
            "side.profile.pill2": "üé¨ MP4 / MOV / MKV",
            "side.profile.pill3": "üéß MP3 / WAV",
            "side.profile.pill4": "üéûÔ∏è GIF courts",
            "side.profile.limit": "Vise quelques centaines de Mo max.",
            "side.info.title": "Infos utiles",
            "side.info.text": "- Plus c‚Äôest compress√©, plus tu perds un peu de d√©tail.<br>- GIF = petit extrait, pas un film.<br>- Fichiers trait√©s puis supprim√©s.",
            "side.info.legal": "Envoie uniquement des fichiers que tu as le droit d‚Äôutiliser.",
            "footer.version": "v0.6 beta",
            "footer.link.about": "√Ä propos",
            "footer.link.faq": "FAQ",
            "footer.link.contact": "Contact (bient√¥t)"
        },
        en: {
            "header.title": "FluxConvert ‚Äì Simple & fast video tools",
            "header.subtitle": "Drop a file, pick a mode, download.",
            "header.badge": "‚ö° 100% free ‚Ä¢ server-side",
            "header.themeDark": "Dark mode",
            "header.themeLight": "Light mode",
            "lang.auto": "Auto",
            "main.title": "One screen, all tools",
            "main.subtitle": "Pick what you want to do, everything else is ready.",
            "modes.convert": "Convert",
            "modes.compress": "Compress",
            "modes.audio": "Audio only",
            "modes.gif": "GIF",
            "modes.cut": "Cut",
            "modes.merge": "Merge",
            "steps.1.title": "Drop your file",
            "steps.1.text": "Video or audio.",
            "steps.2.title": "Pick a mode",
            "steps.2.text": "Convert, compress, audio, GIF, cut or merge.",
            "steps.3.title": "Download",
            "steps.3.text": "File ready in one click.",
            "drop.title": "Drop your file here",
            "drop.subtitle": "or click to browse",
            "drop.help": "MP4, MOV, MKV, MP3, WAV‚Ä¶ you‚Äôre good.",
            "form.formatLabel": "Output format",
            "form.format.mp4": "MP4 (video)",
            "form.format.mp3": "MP3 (audio)",
            "form.format.wav": "WAV",
            "form.format.mkv": "MKV",
            "form.format.mov": "MOV",
            "form.qualityLabel": "Quality / size",
            "form.quality.standard": "Standard",
            "form.quality.light": "Smaller",
            "form.quality.strong": "Tiny",
            "form.resolutionLabel": "Video resolution",
            "form.resolution.source": "Source",
            "form.resolution.480": "480p",
            "form.resolution.720": "720p",
            "form.resolution.1080": "1080p",
            "form.fpsLabel": "Frames per second",
            "form.fps.source": "Source",
            "form.audioBitrateLabel": "Audio bitrate",
            "form.audioBitrate.auto": "Auto",
            "form.speedLabel": "Speed",
            "form.speed.1": "Normal (1√ó)",
            "form.speed.05": "Slow 0.5√ó",
            "form.speed.075": "Slight slow 0.75√ó",
            "form.speed.125": "Slight fast 1.25√ó",
            "form.speed.15": "Fast 1.5√ó",
            "form.speed.2": "Very fast 2√ó",
            "form.reverseLabel": "Reverse",
            "form.reverseHelp": "Play from end to start.",
            "merge.secondary.label": "2nd file to merge: ",
            "time.hint": "GIF / Cut: set a start (sec) + a duration or an end.",
            "time.start": "Start (s)",
            "time.duration": "Duration (s)",
            "time.end": "End (s)",
            "button.label.convert": "Convert",
            "button.label.compress": "Compress",
            "button.label.audio": "Extract audio",
            "button.label.gif": "Create GIF",
            "button.label.cut": "Cut clip",
            "button.label.merge": "Merge videos",
            "button.sub": "Processing is done server-side. Just wait.",
            "status.ready": "Ready when you are.",
            "status.running": "Processing‚Ä¶",
            "summary.reverse": "Reverse",
            "hint.text": "Tip: try with a short clip first.",
            "side.profile.title": "Quick presets",
            "side.profile.convertTitle": "Plays everywhere:",
            "side.profile.convert1": "Convert ¬∑ MP4 ¬∑ Standard",
            "side.profile.socialTitle": "TikTok / Shorts:",
            "side.profile.social1": "Compress ¬∑ MP4 ¬∑ Smaller",
            "side.profile.gifTitle": "Quick GIF:",
            "side.profile.gif1": "GIF ¬∑ 5‚Äì10 seconds max.",
            "side.profile.pill1": "üîÅ Server",
            "side.profile.pill2": "üé¨ MP4 / MOV / MKV",
            "side.profile.pill3": "üéß MP3 / WAV",
            "side.profile.pill4": "üéûÔ∏è Short GIFs",
            "side.profile.limit": "Aim for a few hundred MB max.",
            "side.info.title": "Good to know",
            "side.info.text": "- Stronger compression = less detail.<br>- GIF = small clip, not a movie.<br>- Files processed then removed.",
            "side.info.legal": "Only upload files you‚Äôre allowed to use.",
            "footer.version": "v0.6 beta",
            "footer.link.about": "About",
            "footer.link.faq": "FAQ",
            "footer.link.contact": "Contact (soon)"
        }
    };

    function detectBrowserLang() {
        const navLang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
        if (navLang.startsWith('fr')) return 'fr';
        return 'en';
    }

    function getCurrentLang() {
        const stored = localStorage.getItem('vc-lang');
        if (stored === 'fr' || stored === 'en') return stored;
        const selection = langSelect.value;
        if (selection === 'fr' || selection === 'en') return selection;
        return detectBrowserLang();
    }

    function getDict() {
        const lang = getCurrentLang();
        return translations[lang] || translations.en;
    }

    function applyTranslations(lang) {
        const dict = translations[lang] || translations.en;
        document.querySelectorAll('[data-i18n]').forEach((el) => {
            const key = el.getAttribute('data-i18n');
            if (dict[key]) {
                if (dict[key].includes('<br')) {
                    el.innerHTML = dict[key];
                } else {
                    el.textContent = dict[key];
                }
            }
        });

        const theme = rootBody.getAttribute('data-theme') || 'dark';
        if (theme === 'dark') {
            themeToggleLabel.textContent = dict["header.themeDark"];
        } else {
            themeToggleLabel.textContent = dict["header.themeLight"];
        }

        langSelect.querySelector('option[value="auto"]').textContent = dict["lang.auto"];

        updateButtonLabel();
        updateAdvancedSummary();

        statusText.textContent = dict["status.ready"];
        btnSub.textContent = dict["button.sub"];
        btn.disabled = false;
        statusDot.classList.remove('busy');
        errorBox.style.display = 'none';
        errorBox.textContent = '';
    }

    function initLang() {
        const stored = localStorage.getItem('vc-lang');
        if (stored === 'fr' || stored === 'en') {
            langSelect.value = stored;
            applyTranslations(stored);
        } else {
            langSelect.value = 'auto';
            const detected = detectBrowserLang();
            applyTranslations(detected);
        }
    }

    langSelect.addEventListener('change', () => {
        const value = langSelect.value;
        if (value === 'fr' || value === 'en') {
            localStorage.setItem('vc-lang', value);
            applyTranslations(value);
        } else {
            localStorage.removeItem('vc-lang');
            const detected = detectBrowserLang();
            applyTranslations(detected);
        }
    });

    function applyTheme(theme) {
        rootBody.setAttribute('data-theme', theme);
        const dict = getDict();
        if (theme === 'dark') {
            themeToggleIcon.textContent = 'üåô';
            themeToggleLabel.textContent = dict["header.themeDark"];
        } else {
            themeToggleIcon.textContent = '‚òÄÔ∏è';
            themeToggleLabel.textContent = dict["header.themeLight"];
        }
        localStorage.setItem('vc-theme', theme);
    }

    function initTheme() {
        const stored = localStorage.getItem('vc-theme');
        if (stored === 'light' || stored === 'dark') {
            applyTheme(stored);
        } else {
            const prefersLight = window.matchMedia &&
                window.matchMedia('(prefers-color-scheme: light)').matches;
            applyTheme(prefersLight ? 'light' : 'dark');
        }
    }

    themeToggleBtn.addEventListener('click', () => {
        const current = rootBody.getAttribute('data-theme') || 'dark';
        const next = current === 'dark' ? 'light' : 'dark';
        applyTheme(next);
    });

    function buildSummary() {
        const formatText = targetFormatSelect.options[targetFormatSelect.selectedIndex].textContent;
        const qualityText = qualitySelect.options[qualitySelect.selectedIndex].textContent;
        const resVal = resolutionSelect.value;
        const fpsVal = fpsSelect.value;
        const audioVal = audioBitrateSelect.value;
        const speedVal = speedSelect.value;
        const reverseOn = reverseCheckbox.checked;
        const dict = getDict();

        if (currentMode === 'audio') {
            let bits = [formatText];
            if (audioVal && audioVal !== 'auto') {
                bits.push(audioVal.replace('k', ' kbps'));
            }
            if (speedVal && speedVal !== '1.0') {
                bits.push(speedVal + "√ó");
            }
            if (reverseOn) {
                bits.push(dict["summary.reverse"] || "Reverse");
            }
            return bits.join(' ‚Ä¢ ');
        } else {
            const segments = [formatText];

            if (resVal && resVal !== 'source') {
                segments.push(resVal);
            }
            if (fpsVal && fpsVal !== 'source') {
                segments.push(fpsVal + " fps");
            }
            if (speedVal && speedVal !== '1.0') {
                segments.push(speedVal + "√ó");
            }
            if (reverseOn) {
                segments.push(dict["summary.reverse"] || "Reverse");
            }
            segments.push(qualityText);
            return segments.join(' ‚Ä¢ ');
        }
    }

    function updateAdvancedSummary() {
        advancedSummary.textContent = buildSummary();
    }

    targetFormatSelect.addEventListener('change', updateAdvancedSummary);
    qualitySelect.addEventListener('change', updateAdvancedSummary);
    resolutionSelect.addEventListener('change', updateAdvancedSummary);
    fpsSelect.addEventListener('change', updateAdvancedSummary);
    audioBitrateSelect.addEventListener('change', updateAdvancedSummary);
    speedSelect.addEventListener('change', updateAdvancedSummary);
    reverseCheckbox.addEventListener('change', updateAdvancedSummary);

    advancedToggle.addEventListener('click', () => {
        const isOpen = advancedPanel.style.display === 'block';
        advancedPanel.style.display = isOpen ? 'none' : 'block';
        advancedToggle.classList.toggle('open', !isOpen);
    });

    function updateFilename() {
        const file = fileInput.files[0];
        errorBox.style.display = 'none';
        errorBox.textContent = '';

        if (file) {
            const sizeMB = file.size / 1024 / 1024;
            const sizeRounded = Math.round(sizeMB * 10) / 10;

            filenameEl.style.display = 'inline-block';
            filenameEl.textContent = file.name + ' ‚Ä¢ ' + sizeRounded + ' Mo';

            if (sizeMB > MAX_FILE_MB) {
                const lang = getCurrentLang();
                errorBox.style.display = 'block';
                errorBox.textContent =
                    lang === 'fr'
                        ? `Ton fichier fait ${sizeRounded} Mo. Limite actuelle : ${MAX_FILE_MB} Mo.`
                        : `Your file is ${sizeRounded} MB. Current limit: ${MAX_FILE_MB} MB.`;

                btn.disabled = true;
                statusDot.classList.remove('busy');
                statusText.textContent =
                    lang === 'fr'
                        ? "Fichier trop volumineux."
                        : "File is too large.";
            } else {
                btn.disabled = false;
                const dict = getDict();
                statusDot.classList.remove('busy');
                statusText.textContent = dict["status.ready"];
            }
        } else {
            filenameEl.style.display = 'none';
            filenameEl.textContent = '';
            btn.disabled = false;
        }
    }

    function updateFilename2() {
        const file = file2Input.files[0];
        if (!file) {
            secondaryFilename.textContent = "";
            return;
        }
        const sizeMB = file.size / 1024 / 1024;
        const sizeRounded = Math.round(sizeMB * 10) / 10;
        secondaryFilename.textContent = file.name + " ‚Ä¢ " + sizeRounded + " Mo";
    }

    dropzone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropzone.classList.add('dragover');
    });

    dropzone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropzone.classList.remove('dragover');
    });

    dropzone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropzone.classList.remove('dragover');
        if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
            fileInput.files = e.dataTransfer.files;
            updateFilename();
        }
    });

    fileInput.addEventListener('change', updateFilename);
    file2Input.addEventListener('change', updateFilename2);

    secondaryUpload.addEventListener('click', () => {
        if (currentMode === 'merge') {
            file2Input.click();
        }
    });

    function updateButtonLabel() {
        const dict = getDict();
        const key = "button.label." + currentMode;
        if (dict[key]) {
            btnMainLabel.textContent = dict[key];
        } else {
            btnMainLabel.textContent = dict["button.label.convert"];
        }
    }

    function setMode(mode) {
        currentMode = mode;
        modeTabs.forEach(btn => {
            btn.classList.toggle('active', btn.dataset.mode === mode);
        });

        if (mode === 'compress') {
            operationInput.value = 'compress';
        } else if (mode === 'audio') {
            operationInput.value = 'audio';
        } else if (mode === 'gif') {
            operationInput.value = 'gif';
        } else if (mode === 'cut') {
            operationInput.value = 'cut';
        } else if (mode === 'merge') {
            operationInput.value = 'merge';
        } else {
            operationInput.value = 'convert';
        }

        if (mode === 'gif') {
            timeWrapper.style.display = 'block';
            durationGroup.style.display = 'block';
            endTimeGroup.style.display = 'none';
        } else if (mode === 'cut') {
            timeWrapper.style.display = 'block';
            durationGroup.style.display = 'none';
            endTimeGroup.style.display = 'block';
        } else {
            timeWrapper.style.display = 'none';
        }

        if (mode === 'audio') {
            targetFormatSelect.value = 'mp3';
        } else if (mode === 'convert') {
            targetFormatSelect.value = 'mp4';
            qualitySelect.value = 'standard';
            resolutionSelect.value = '720p';
            fpsSelect.value = '30';
            audioBitrateSelect.value = 'auto';
        } else if (mode === 'compress') {
            targetFormatSelect.value = 'mp4';
            qualitySelect.value = 'light';
            resolutionSelect.value = '720p';
            fpsSelect.value = '30';
        }

        if (mode === 'merge') {
            secondaryUpload.style.display = 'block';
        } else {
            secondaryUpload.style.display = 'none';
            secondaryFilename.textContent = "";
            file2Input.value = "";
        }

        speedSelect.value = "1.0";
        reverseCheckbox.checked = false;

        startTimeInput.value = '';
        durationInput.value = '';
        endTimeInput.value = '';

        updateAdvancedSummary();
        updateButtonLabel();

        const dict = getDict();
        statusText.textContent = dict["status.ready"];
        errorBox.style.display = 'none';
        errorBox.textContent = '';
    }

    modeTabs.forEach(btn => {
        btn.addEventListener('click', () => {
            const mode = btn.dataset.mode;
            setMode(mode);
        });
    });

    form.addEventListener('submit', (e) => {
        const file = fileInput.files[0];
        const dict = getDict();
        const lang = getCurrentLang();

        errorBox.style.display = 'none';
        errorBox.textContent = '';

        if (!file) {
            e.preventDefault();
            errorBox.style.display = 'block';
            errorBox.textContent =
                lang === 'fr'
                    ? "Ajoute un fichier avant de lancer."
                    : "Please add a file first.";
            return;
        }

        if (currentMode === 'merge') {
            const file2 = file2Input.files[0];
            if (!file2) {
                e.preventDefault();
                errorBox.style.display = 'block';
                errorBox.textContent =
                    lang === 'fr'
                        ? "Pour fusionner, ajoute aussi un 2·µâ fichier."
                        : "For merge, please add a second file.";
                return;
            }
        }

        const sizeMB = file.size / 1024 / 1024;
        if (sizeMB > MAX_FILE_MB) {
            e.preventDefault();
            errorBox.style.display = 'block';
            errorBox.textContent =
                lang === 'fr'
                    ? `Fichier trop gros (${Math.round(sizeMB)} Mo). Limite : ${MAX_FILE_MB} Mo.`
                    : `File too large (${Math.round(sizeMB)} MB). Limit: ${MAX_FILE_MB} MB.`;
            return;
        }

        if (currentMode === 'gif') {
            const durationVal = durationInput.value.trim();
            if (!durationVal) {
                e.preventDefault();
                errorBox.style.display = 'block';
                errorBox.textContent =
                    lang === 'fr'
                        ? "Pour un GIF, indique au moins une dur√©e."
                        : "For a GIF, please set at least a duration.";
                return;
            }
        }

        if (currentMode === 'cut') {
            const endVal = endTimeInput.value.trim();
            if (!endVal) {
                e.preventDefault();
                errorBox.style.display = 'block';
                errorBox.textContent =
                    lang === 'fr'
                        ? "Pour un cut, indique une fin."
                        : "For a cut, please set an end time.";
                return;
            }
        }

        btn.disabled = true;
        statusDot.classList.add('busy');
        statusText.textContent = dict["status.running"];
        btnSub.textContent =
            lang === 'fr'
                ? "Le temps d√©pend de la taille du fichier."
                : "Time depends on file size.";
    });

    function initTheme() {
        const stored = localStorage.getItem('vc-theme');
        if (stored === 'light' || stored === 'dark') {
            applyTheme(stored);
        } else {
            const prefersLight = window.matchMedia &&
                window.matchMedia('(prefers-color-scheme: light)').matches;
            applyTheme(prefersLight ? 'light' : 'dark');
        }
    }

    function applyTheme(theme) {
        rootBody.setAttribute('data-theme', theme);
        const dict = getDict();
        if (theme === 'dark') {
            themeToggleIcon.textContent = 'üåô';
            themeToggleLabel.textContent = dict["header.themeDark"];
        } else {
            themeToggleIcon.textContent = '‚òÄÔ∏è';
            themeToggleLabel.textContent = dict["header.themeLight"];
        }
        localStorage.setItem('vc-theme', theme);
    }

    themeToggleBtn.addEventListener('click', () => {
        const current = rootBody.getAttribute('data-theme') || 'dark';
        const next = current === 'dark' ? 'light' : 'dark';
        applyTheme(next);
    });

    function detectPreset() {
        const presetMode = rootBody.dataset.presetMode;
        const presetFormat = rootBody.dataset.presetFormat;

        if (presetMode) {
            setMode(presetMode);
        } else {
            setMode('convert');
        }

        if (presetFormat) {
            targetFormatSelect.value = presetFormat;
        }

        updateAdvancedSummary();
    }

    initLang();
    initTheme();
    detectPreset();
    advancedPanel.style.display = 'none';
});
</script>
</body>
</html>
